name: Release

on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Bump version and create tag
        id: tag_version
        uses: anothrNick/github-tag-action@1.67.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          WITH_V: true
          DEFAULT_BUMP: patch
          RELEASE_BRANCHES: main
          PRERELEASE: false

      - name: Create GitHub release
        if: steps.tag_version.outputs.new_tag != ''
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.tag_version.outputs.new_tag }}
          name: Release ${{ steps.tag_version.outputs.new_tag }}
          body: |
            ## Changes in ${{ steps.tag_version.outputs.new_tag }}

            Previous version: ${{ steps.tag_version.outputs.tag }}

            See commit history for details: https://github.com/${{ github.repository }}/compare/${{ steps.tag_version.outputs.tag }}...${{ steps.tag_version.outputs.new_tag }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Release summary
        run: |
          echo "‚úÖ Release workflow completed"
          echo ""
          echo "Previous tag: ${{ steps.tag_version.outputs.tag }}"
          echo "New tag: ${{ steps.tag_version.outputs.new_tag }}"
          echo "Part: ${{ steps.tag_version.outputs.part }}"
          echo ""
          echo "üìç Release: https://github.com/${{ github.repository }}/releases/tag/${{ steps.tag_version.outputs.new_tag }}"
          echo "üì¶ Package: https://pkg.go.dev/github.com/algebananazzzzz/planear@${{ steps.tag_version.outputs.new_tag }}"
